!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ChatCamp",[],t):"object"==typeof exports?exports.ChatCamp=t():e.ChatCamp=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=30)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(31),s=function(e){return e&&e.__esModule?e:{default:e}}(o),i=function e(t){r(this,e)};i.prototype=(0,s.default)(),e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),l=r(c),f=n(12),h=r(f),d=n(51),p=(r(d),n(21)),g=r(p),y=n(4),m=(r(y),n(24)),v=(r(m),n(5)),_=r(v),b=n(57),k=r(b),w=n(6),C=(r(w),n(10)),I=(r(C),n(58)),T=r(I),S=n(3),O=(r(S),n(25)),E=r(O),x=n(59),P=r(x),F=n(9),M=r(F),L=n(27),A=r(L),j=n(29),R=r(j),G=n(60),U=r(G),N=n(61),D=r(N),q=n(8),H=r(q),B=n(20),$=r(B),K=null,J=function(e){function t(e){var n;o(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.baseUrl="https://api.chatcamp.io/api/1.0",h.default.defaults.withCredentials=!0;var i=t.getInstance();return i?(n=i,s(r,n)):(r.onlineUsers=new k.default,r.messages=[],r.channelListeners={},r.connectionListeners={},r.dms={},r.rooms={},r.autoReconnectEnabled=!0,r.userForceToDisconnect=!1,r.tick=setInterval(function(){var e=t.getInstance().GroupChannel.cachedChannels;for(var n in e){if(e[n].checkTypingStatus())for(var r in t.getInstance().getChannelListenersMap()){var o=t.getInstance().getChannelListenersMap()[r];o.onGroupChannelTypingStatusChanged(e[n])}}},1e3),r.app=new g.default(e),r.titleBlink=new T.default({interval:null,oldTitle:document.title,isOldTitle:!0,client:r}),K=r,r)}return i(t,e),u(t,[{key:"connect",value:function(){2==arguments.length?"string"==typeof arguments[0]&&a("function"===arguments[1])&&this.connectUser(arguments[0],arguments[1]):3==arguments.length?"string"==typeof arguments[0]&&"string"==typeof arguments[1]&&a("function"===arguments[2])?this.connectUserWithAccessToken(arguments[0],arguments[1],arguments[2]):"string"==typeof arguments[0]&&void 0===arguments[1]&&a("function"===arguments[2])&&this.connectUser(arguments[0],arguments[2]):4==arguments.length?"string"==typeof arguments[0]&&"string"==typeof arguments[1]&&"string"==typeof arguments[2]&&"function"==typeof arguments[3]&&this.customConnectUser(arguments[0],arguments[1],arguments[2],arguments[3]):5==arguments.length&&("string"==typeof arguments[0]&&"string"==typeof arguments[1]&&"string"==typeof arguments[2]&&"string"==typeof arguments[3]&&"function"==typeof arguments[4]?this.customConnectUserWithAccessToken(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):"string"==typeof arguments[0]&&void 0===arguments[1]&&"string"==typeof arguments[2]&&"string"==typeof arguments[3]&&"function"==typeof arguments[4]&&this.customConnectUser(arguments[0],arguments[2],arguments[3],arguments[4]))}},{key:"connectUser",value:function(e,t){return this._connect({userId:e},t)}},{key:"connectUserWithAccessToken",value:function(e,t,n){return this._connect({userId:e,accessToken:t},n)}},{key:"customConnectUser",value:function(e,t,n,r){return this.baseUrl="https://"+t+":"+n+"/api/1.0",t="wss://"+t,this._connect({userId:e,host:t,port:n},r)}},{key:"customConnectUserWithAccessToken",value:function(e,t,n,r,o){return this.baseUrl="https://"+n+":"+r+"/api/1.0",n="wss://"+n,this._connect({userId:e,accessToken:t,host:n,port:r},o)}},{key:"_connect",value:function(e,t){var n=this;this.callbackConnected=function(e){return n.off("users.auth",n.callbackConnected),t(null,e)},this.userForceToDisconnect=!1,this.on("users.auth",this.callbackConnected);var r={client:this,app_id:this.app.id,userId:e.userId};e.accessToken&&(r.accessToken=e.accessToken),e.host&&e.port&&(r.host=e.host,r.port=e.port),this.transportManager=new H.default(r),this.transportManager._connect(r),this.eventManager=new $.default(this,this.transportManager)}},{key:"_uploadAttachment",value:function(e,t,n,r,o){var s=new FormData;s.append("app_id",this.app.id),s.append("user_id",this.user.id),s.append("channel_type",t),s.append("channel_id",n),s.append("attachment",e);var i={headers:{"content-type":"multipart/form-data"},onUploadProgress:function(e){r(e.loaded,e.total)}};h.default.post(this.baseUrl+"/attachment_upload",s,i).then(function(e){return e.data&&e.data.attachment?o(null,e.data.attachment):o(!0,null)}).catch(function(e){return o(e,null)})}},{key:"updateUserDisplayName",value:function(e,t){return this.user.updateDisplayNameOnServer(e,t)}},{key:"updateUserProfileUrl",value:function(e,t){return this.user.updateProfileUrlOnServer(e,t)}},{key:"updateUserAvatarUrl",value:function(e,t){return this.user.updateAvatarUrlOnServer(e,t)}},{key:"updateUserMetadata",value:function(e,t){return this.user.updateMetadataOnServer(e,t)}},{key:"addChannelListener",value:function(e,t){this.channelListeners[e]=t}},{key:"addConnectionListener",value:function(e,t){this.connectionListeners[e]=t}},{key:"getChannelListenersMap",value:function(){return this.channelListeners}},{key:"getConnectionListenersMap",value:function(){return this.connectionListeners}},{key:"createUserListQuery",value:function(){return new U.default}},{key:"setAutoReconnectEnabled",value:function(e){this.autoReconnectEnabled=e}},{key:"isAutoReconnectEnabled",value:function(){return this.autoReconnectEnabled}},{key:"hasUserForcedDisconnect",value:function(){return this.userForceToDisconnect}}]),t}(l.default);J.getInstance=function(){return null===K?null:K},J.prototype.GroupChannel=E.default,J.prototype.OpenChannel=D.default,J.prototype.Message=_.default,J.prototype.GroupChannelListQuery=A.default,J.prototype.OpenChannelListQuery=R.default,J.prototype.ChannelListener=P.default,J.prototype.ConnectionListener=M.default,t.default=J},function(e,t,n){"use strict";function r(e){return"[object Array]"===I.call(e)}function o(e){return"[object ArrayBuffer]"===I.call(e)}function s(e){return"undefined"!=typeof FormData&&e instanceof FormData}function i(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function a(e){return"string"==typeof e}function u(e){return"number"==typeof e}function c(e){return void 0===e}function l(e){return null!==e&&"object"==typeof e}function f(e){return"[object Date]"===I.call(e)}function h(e){return"[object File]"===I.call(e)}function d(e){return"[object Blob]"===I.call(e)}function p(e){return"[object Function]"===I.call(e)}function g(e){return l(e)&&p(e.pipe)}function y(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function m(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function v(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function _(e,t){if(null!==e&&void 0!==e)if("object"==typeof e||r(e)||(e=[e]),r(e))for(var n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}function b(){function e(e,n){"object"==typeof t[n]&&"object"==typeof e?t[n]=b(t[n],e):t[n]=e}for(var t={},n=0,r=arguments.length;n<r;n++)_(arguments[n],e);return t}function k(e,t,n){return _(t,function(t,r){e[r]=n&&"function"==typeof t?w(t,n):t}),e}var w=n(13),C=n(33),I=Object.prototype.toString;e.exports={isArray:r,isArrayBuffer:o,isBuffer:C,isFormData:s,isArrayBufferView:i,isString:a,isNumber:u,isObject:l,isUndefined:c,isDate:f,isFile:h,isBlob:d,isFunction:p,isStream:g,isURLSearchParams:y,isStandardBrowserEnv:v,forEach:_,merge:b,extend:k,trim:m}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),l=n(1),f=r(l),h=n(10),d=(r(h),function(e){function t(e,n){o(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.id="",r.displayName="",r.firstName="",r.lastName="",r.email="",r.phoneNumber="",r.profileUrl="",r.avatarUrl="",r.lastSeen=0,r.isSuspended=!1,r.checkAccessToken=!1,e.id&&(r.id=e.id),e.display_name&&(r.displayName=e.display_name),e.first_name&&(r.firstName=e.first_name),e.last_name&&(r.lastName=e.last_name),e.email&&(r.email=e.email),e.phone_number&&(r.phoneNumber=e.phone_number),e.profile_url&&(r.profileUrl=e.profile_url),e.avatar_url&&(r.avatarUrl=e.avatar_url),e.last_seen?r.lastSeen=e.last_seen:r.lastSeen=0,e.is_suspended&&(r.isSuspended=e.is_suspended),e.check_access_token&&(r.checkAccessToken=e.check_access_token),e.access_token&&(r.accessToken=e.access_token),e.metadata&&(r.metadata=e.metadata),e.is_online?r.isOnline=e.is_online:r.isOnline=!1,r.client=n,s(r)}return i(t,e),a(t,[{key:"updateDisplayNameOnServer",value:function(e,t){var n={id:this.id,display_name:e};return this.updateUserOnServer(n,t)}},{key:"updateProfileUrlOnServer",value:function(e,t){var n={id:this.id,profile_url:e};return this.updateUserOnServer(n,t)}},{key:"updateAvatarUrlOnServer",value:function(e,t){var n={id:this.id,avatar_url:e};return this.updateUserOnServer(n,t)}},{key:"updateMetadataOnServer",value:function(e,t){var n={id:this.id,metadata:e};return this.updateUserOnServer(n,t)}},{key:"updateUserOnServer",value:function(e,t){var n={t:"users.update",d:e},r=this.client.transportManager.send(n),o=function e(n){return window.setTimeout(function(){f.default.getInstance().off("to."+r+".success",e),f.default.getInstance().off("to."+r+".error",s)},0),t(null,n)},s=function e(n){new ChatCampException(n);return window.setTimeout(function(){f.default.getInstance().off("to."+r+".success",o),f.default.getInstance().off("to."+r+".error",e)},0),t(n,null)};return f.default.getInstance().on("to."+r+".success",o),f.default.getInstance().on("to."+r+".error",s),!0}},{key:"updateStatus",value:function(e){var t={status:e};this.client.transportManager.send({t:"users.updateStatus",d:t})}},{key:"updateSoundNotification",value:function(e){var t={sound:e};this.client.transportManager.send({t:"users.updateSoundNotification",d:t})}}]),t}(c.default));t.default=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),l=n(3),f=(r(l),n(5)),h=r(f),d=n(22),p=r(d),g=n(23),y=r(g),m=function(e){function t(e){o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.client=e.client,n._receivedFromServer=e._receivedFromServer,e.id&&(n.id=e.id),n.members=e.members,n.lastMessage=e.lastMessage,n.createdBy=e.createdBy,n.typingIndicatorPublisher=new y.default({dm:n}),n.typingIndicatorListener=new p.default({dm:n}),e.messages?n.messages=e.messages:n.messages=[],n.threadId=e.threadId,n}return i(t,e),a(t,[{key:"getHistory",value:function(){this.client.transportManager.send({t:"dm.getHistory",d:{id:this.id,ref:this.messages.length?this.messages[0].id:null}})}},{key:"create",value:function(){var e=this;this.r=this.client.transportManager.send({t:"dm.create",d:{members:this.members}}),this.toFunc=function(t){e.id=t.dm.id,e.threadId=t.dm.id,window.setTimeout(function(){e.client.off("to."+e.r,e.toFunc)},0)},this.client.on("to."+this.r,this.toFunc)}},{key:"createMessage",value:function(e){e.client=this.client,e.type="dm",e._receivedFromServer=!1;var t=this;return e.thread=t,e.sender=this.client.user,new h.default(e)}}]),t}(c.default);t.default=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3),a=r(i),u=n(1),c=(r(u),n(0)),l=(r(c),n(4)),f=(r(l),n(6)),h=(r(f),n(55)),d=(r(h),function(){function e(t){o(this,e),this.id=t.id,this.type=t.type,"attachment"===t.type?this.attachment=t.attachment:this.text=t.text,t.custom_type?this.customType=t.custom_type:this.customType="",t.metadata?this.metadata=t.metadata:this.metadata={},this.user=new a.default(t.user),this.insertedAt=t.inserted_at}return s(e,[{key:"getText",value:function(){return this.text}},{key:"getUser",value:function(){return this.user}}]),e}());t.default=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),l=n(5),f=r(l),h=n(22),d=r(h),p=n(23),g=r(p),y=n(3),m=(r(y),function(e){function t(e){o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.id=e.id,n.type=e.type,n.name=e.name,n.client=e.client,n.historyComplete=!1,n.typingIndicatorPublisher=new g.default({room:n}),n.typingIndicatorListener=new d.default({room:n}),e.messages?n.messages=e.messages:n.messages=[],n}return i(t,e),a(t,[{key:"getHistory",value:function(){!1===this.historyComplete&&this.client.transportManager.send({t:"rooms.getHistory",d:{id:this.id,ref:this.messages.length?this.messages[0].id:null}})}},{key:"createMessage",value:function(e){e.client=this.client,e._receivedFromServer=!1;var t=this;return e.thread=t,e.type="room",e.sender=this.client.user,e.insertedAt=Math.floor((new Date).getTime()/1e3),new f.default(e)}}]),t}(c.default));t.default=m},function(e,t,n){"use strict";(function(t){function r(e,t){!o.isUndefined(e)&&o.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var o=n(2),s=n(36),i={"Content-Type":"application/x-www-form-urlencoded"},a={adapter:function(){var e;return"undefined"!=typeof XMLHttpRequest?e=n(14):void 0!==t&&(e=n(14)),e}(),transformRequest:[function(e,t){return s(t,"Content-Type"),o.isFormData(e)||o.isArrayBuffer(e)||o.isBuffer(e)||o.isStream(e)||o.isFile(e)||o.isBlob(e)?e:o.isArrayBufferView(e)?e.buffer:o.isURLSearchParams(e)?(r(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):o.isObject(e)?(r(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};a.headers={common:{Accept:"application/json, text/plain, */*"}},o.forEach(["delete","get","head"],function(e){a.headers[e]={}}),o.forEach(["post","put","patch"],function(e){a.headers[e]=o.merge(i)}),e.exports=a}).call(t,n(35))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),l=r(c),f=n(53),h=r(f),d=n(18),p=r(d),g=n(1),y=r(g),m=n(9),v=(r(m),function(e){function t(e){o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.client=e.client,n.heartbeatFrequency=3e4,n._nextHeartbeatId=0,n.open=!1,n.timesOpened=0,n._reconnectDelay=1,n._maxReconnectDelay=120,n._listeners={},n.host="wss://api.chatcamp.io",n.port="443",e.host&&(n.host=e.host),e.port&&(n.port=e.port),n._r=0,n}return i(t,e),u(t,[{key:"_connect",value:function(e){this.accessToken=e.accessToken,this.userId=e.userId,e.accessToken?this._socket=new h.default(this.host+":"+this.port+"/chat/1.0?app_id="+this.client.app.id+"&user_id="+e.userId+"&access_token="+e.accessToken,{disableWebSocket:!1,disableEventSource:!0,disableXHRPolling:!1}):this._socket=new h.default(this.host+":"+this.port+"/chat/1.0?app_id="+this.client.app.id+"&user_id="+e.userId,{disableWebSocket:!1,disableEventSource:!0,disableXHRPolling:!1}),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onDisconnect.bind(this),this._socket.ondisconnect=this._onDisconnect.bind(this),this._socket.onopen=this._onOpen.bind(this),this._socket.onerror=this._onError.bind(this)}},{key:"setHost",value:function(e){this.host=e}},{key:"setPort",value:function(e){this.port=e}},{key:"_onOpen",value:function(){p.default.debug("chat socket: opened",this._socket.transportType),this.open=!0,this.timesOpened++,this._rescheduleHeartbeat(),this.emit("open")}},{key:"_onMessage",value:function(e){this._reconnectDelay=1,p.default.debug("chat socket: message",void 0===e?"undefined":a(e));var t=JSON.parse(e.data);this.emit("message",t),p.default.debug(t)}},{key:"_onDisconnect",value:function(){this.open=!1,this.emit("close");var e=this,t=y.default.getInstance().getConnectionListenersMap();for(var n in t){t[n].onConnectionChanged(!1)}setTimeout(function(){e._reconnectDelay<=e._maxReconnectDelay&&(e._reconnectDelay=2*e._reconnectDelay),e._reconnect()},this._reconnectDelay>this._maxReconnectDelay?1e3*this._maxReconnectDelay:1e3*this._reconnectDelay)}},{key:"_onHeartbeat",value:function(){this.send({t:"ping"})}},{key:"_onClose",value:function(){}},{key:"_onError",value:function(e){this._socket.transportType}},{key:"send",value:function(e){return this._r++,e.r=this._r,e.l&&(this._listeners["r_"+e.r]=e.l,delete e.l),this.open&&this._socket.send(JSON.stringify(e)),this._r}},{key:"_rescheduleHeartbeat",value:function(){this._nextHeartbeatId&&clearTimeout(this._nextHeartbeatId),this._nextHeartbeatId=setTimeout(this._heartbeat.bind(this),this.heartbeatFrequency)}},{key:"_heartbeat",value:function(){this._nextHeartbeatId=0,this.send({t:"ping"}),this._rescheduleHeartbeat()}},{key:"_reconnect",value:function(){if(this._socket=null,this.open=!1,clearTimeout(this._nextHeartbeatId),!this.client.hasUserForcedDisconnect()&&this.client.isAutoReconnectEnabled()){var e=void 0,t=null;if(this.client.user&&this.client.user.accessToken&&this.client.user.id?(t=this.client.user.accessToken,e=this.client.user.id):this.client.user&&this.client.user.id?e=this.client.user.id:this.userId&&this.accessToken?(t=this.accessToken,e=this.userId):this.userId&&(e=this.userId),e&&t)return this._connect({userId:e,accessToken:t}),!0;if(e)return this._connect({userId:e}),!0}return!1}}]),t}(l.default));t.default=v},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(){r(this,e),this.onConnectionChanged=function(e){}};t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),l=n(1),f=(r(l),n(4)),h=r(f),d=n(6),p=(r(d),n(5)),g=r(p),y=function(e){function t(e){o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.type=e.type,n.id=e.id,n.client=e.client,n.members=e.members,n}return i(t,e),a(t,[{key:"create",value:function(e){if("dm"===this.type)return new h.default(this);this.type}},{key:"createMessage",value:function(e){return e._receivedFromServer=!1,new g.default(e)}}]),t}(c.default);t.default=y},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(3),u=function(e){return e&&e.__esModule?e:{default:e}}(a),c=function(e){function t(e,n){r(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return e.status&&(s.status=e.status),s}return s(t,e),i(t,[{key:"getInvitationState",value:function(){}}]),t}(u.default);t.default=c},function(e,t,n){e.exports=n(32)},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},function(e,t,n){"use strict";var r=n(2),o=n(37),s=n(39),i=n(40),a=n(41),u=n(15),c="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||n(42);e.exports=function(e){return new Promise(function(t,l){var f=e.data,h=e.headers;r.isFormData(f)&&delete h["Content-Type"];var d=new XMLHttpRequest,p="onreadystatechange",g=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in d||a(e.url)||(d=new window.XDomainRequest,p="onload",g=!0,d.onprogress=function(){},d.ontimeout=function(){}),e.auth){var y=e.auth.username||"",m=e.auth.password||"";h.Authorization="Basic "+c(y+":"+m)}if(d.open(e.method.toUpperCase(),s(e.url,e.params,e.paramsSerializer),!0),d.timeout=e.timeout,d[p]=function(){if(d&&(4===d.readyState||g)&&(0!==d.status||d.responseURL&&0===d.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in d?i(d.getAllResponseHeaders()):null,r=e.responseType&&"text"!==e.responseType?d.response:d.responseText,s={data:r,status:1223===d.status?204:d.status,statusText:1223===d.status?"No Content":d.statusText,headers:n,config:e,request:d};o(t,l,s),d=null}},d.onerror=function(){l(u("Network Error",e,null,d)),d=null},d.ontimeout=function(){l(u("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",d)),d=null},r.isStandardBrowserEnv()){var v=n(43),_=(e.withCredentials||a(e.url))&&e.xsrfCookieName?v.read(e.xsrfCookieName):void 0;_&&(h[e.xsrfHeaderName]=_)}if("setRequestHeader"in d&&r.forEach(h,function(e,t){void 0===f&&"content-type"===t.toLowerCase()?delete h[t]:d.setRequestHeader(t,e)}),e.withCredentials&&(d.withCredentials=!0),e.responseType)try{d.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&d.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&d.upload&&d.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){d&&(d.abort(),l(e),d=null)}),void 0===f&&(f=null),d.send(f)})}},function(e,t,n){"use strict";var r=n(38);e.exports=function(e,t,n,o,s){var i=new Error(e);return r(i,t,n,o,s)}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";function r(e){this.message=e}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,e.exports=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(19).LOG,a=i.DEBUG,u=i.INFO,c=i.WARN,l=i.ERROR,f=i.NONE,h=(Boolean(console.assert&&"".match(/assert/)),function(){function e(){r(this,e)}return s(e,[{key:"log",value:function(e,t,n,r){"object"===(void 0===e?"undefined":o(e))&&(e,e="");(new Date).toLocaleTimeString();switch(n){case a:"debug";break;case u:"info";break;case c:"warn";break;case l:"error";break;default:"log"}}},{key:"debug",value:function(e,t){this.level>=a&&this.log(e,t,a,"#888")}},{key:"info",value:function(e,t){this.level>=u&&this.log(e,t,u,"black")}},{key:"warn",value:function(e,t){this.level>=c&&this.log(e,t,c,"orange")}},{key:"error",value:function(e,t){this.level>=l&&this.log(e,t,l,"red")}}]),e}());h.prototype.level="undefined"==typeof jasmine?l:f;var d=new h;e.exports=d},function(e,t,n){"use strict";e.exports={SYNC_STATE:{NEW:"NEW",SAVING:"SAVING",SYNCING:"SYNCING",SYNCED:"SYNCED",LOADING:"LOADING"},RECIPIENT_STATE:{NONE:"NONE",SOME:"SOME",ALL:"ALL"},RECEIPT_STATE:{SENT:"sent",DELIVERED:"delivered",READ:"read",PENDING:"pending"},LOCALSTORAGE_KEYS:{SESSIONDATA:"iflychat-session-data-"},ACCEPT:"application/vnd.iflychat+json; version=2.0",WEBSOCKET_PROTOCOL:"iflychat-2.0",LOG:{DEBUG:4,INFO:3,WARN:2,ERROR:1,NONE:0},DELETION_MODE:{ALL:"all_participants",MY_DEVICES:"my_devices"},TYPING_STATE:{STARTED:"started",PAUSED:"paused",FINISHED:"finished"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),l=n(21),f=r(l),h=n(1),d=r(h),p=n(4),g=(r(p),n(24)),y=(r(g),n(5)),m=r(y),v=n(6),_=r(v),b=n(8),k=(r(b),n(3)),w=r(k),C=n(11),I=r(C),T=n(9),S=(r(T),function(e){function t(e,n){o(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.client=e,r.transportManager=n,r.transportManager.on("message",r._handleMessage.bind(r)),r}return i(t,e),a(t,[{key:"_handleMessage",value:function(e){switch(e.t){case"app.get.ack":this._handleAppInfo(e);break;case"group_channels.create.ack":this._handleGroupChannelCreated(e.d,e.to);break;case"group_channels.history.ack":this._handleGroupChannelHistory(e.d,e.to);break;case"group_channels.get.ack":this._handleGroupChannelInfo(e.d,e.to);break;case"group_channels.update.ack":break;case"group_channels.update.pub":this._handleGroupChannelUpdatePub(e.d);break;case"group_channels.invite.ack":this._handleGroupChannelInviteAck(e.d,e.to);break;case"group_channels.accept.ack":this._handleGroupChannelAcceptAck(e.d,e.to);break;case"group_channels.invite.pub":this._handleGroupChannelInvitePub(e.d);break;case"group_channels.accept.pub":this._handleGroupChannelAcceptPub(e.d);break;case"group_channels.decline.ack":this._handleGroupChannelDeclineAck(e.d,e.to);break;case"group_channels.decline.pub":this._handleGroupChannelDeclinePub(e.d);break;case"group_channels.leave.ack":this._handleGroupChannelLeaveAck(e.d,e.to);break;case"group_channels.leave.pub":this._handleGroupChannelLeavePub(e.d);break;case"group_channels.my_list.ack":this._handleGroupChannelMyList(e.d,e.to);break;case"group_channels.message.ack":this._handleGroupChannelMessageSent(e.d,e.to);break;case"group_channels.message.pub":this._handleGroupChannelMessage(e.d,e.to);break;case"group_channels.start_typing.pub":this._handleGroupChannelStartTypingPub(e.d,e.to);break;case"group_channels.start_typing.ack":break;case"group_channels.stop_typing.pub":this._handleGroupChannelStopTypingPub(e.d,e.to);break;case"group_channels.stop_typing.ack":break;case"group_channels.read.ack":this._handleGroupChannelReadAck(e.d,e.to);break;case"group_channels.read.pub":this._handleGroupChannelReadPub(e.d);break;case"open_channels.get.ack":this._handleOpenChannelInfo(e.d,e.to);break;case"open_channels.history.ack":this._handleOpenChannelHistory(e.d,e.to);break;case"open_channels.join.ack":this._handleOpenChannelJoinAck(e.d,e.to);break;case"open_channels.join.pub":this._handleOpenChannelJoinPub(e.d);break;case"open_channels.leave.ack":this._handleOpenChannelLeaveAck(e.d,e.to);break;case"open_channels.leave.pub":this._handleOpenChannelLeavePub(e.d);break;case"open_channels.list.ack":this._handleOpenChannelList(e.d,e.to);break;case"open_channels.message.ack":this._handleOpenChannelMessageSent(e.d,e.to);break;case"open_channels.message.pub":this._handleOpenChannelMessage(e.d,e.to);break;case"users.auth.ack":this._handleUsersAuth(e.d,e.to);break;case"users.get.ack":case"users.update.ack":this._handleUsersInfo(e.d,e.to);break;case"users.list.ack":this._handleUsersList(e.d,e.to);break;default:this.client.emit(e.t,e.d)}}},{key:"_handleAppInfo",value:function(e){e.d.ok&&(this.client.app=new f.default({id:e.d.app.id,name:e.d.app.name,notification:e.d.app.notification,theme:e.d.app.theme,client:this.client}))}},{key:"_handleGroupChannelInviteAck",value:function(e,t){if(e.ok){var n=e.group_channel,r=new(d.default.getInstance().GroupChannel)(n);t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleGroupChannelAcceptAck",value:function(e,t){if(e.ok){var n=e.group_channel,r=new(d.default.getInstance().GroupChannel)(n);t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleGroupChannelInvitePub",value:function(e){if(e.ok){var t=e.group_channel,n=e.users,r=new(d.default.getInstance().GroupChannel)(t);for(var o in d.default.getInstance().getChannelListenersMap()){var s=d.default.getInstance().getChannelListenersMap()[o];for(var i in n){var a=new I.default(n[i]);s.onGroupChannelParticipantInvited(r,a)}}}}},{key:"_handleGroupChannelAcceptPub",value:function(e){if(e.ok){var t=e.group_channel,n=e.users,r=new(d.default.getInstance().GroupChannel)(t);d.default.getInstance().GroupChannel.cachedChannels||(d.default.getInstance().GroupChannel.cachedChannels=[]),d.default.getInstance().GroupChannel.cachedChannels[r.getId()]=r;for(var o in d.default.getInstance().getChannelListenersMap()){var s=d.default.getInstance().getChannelListenersMap()[o];for(var i in n){var a=new I.default(n[i]);s.onGroupChannelParticipantJoined(r,a)}}}}},{key:"_handleGroupChannelDeclineAck",value:function(e,t){if(e.ok){var n=e.group_channel,r=new(d.default.getInstance().GroupChannel)(n);t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleGroupChannelDeclinePub",value:function(e){if(e.ok){var t=e.group_channel,n=e.users,r=new(d.default.getInstance().GroupChannel)(t);d.default.getInstance().GroupChannel.cachedChannels||(d.default.getInstance().GroupChannel.cachedChannels=[]),d.default.getInstance().GroupChannel.cachedChannels[r.getId()]=r;for(var o in d.default.getInstance().getChannelListenersMap()){var s=d.default.getInstance().getChannelListenersMap()[o];for(var i in n){var a=new I.default(n[i]);s.onGroupChannelParticipantDeclined(r,a)}}}}},{key:"_handleGroupChannelLeaveAck",value:function(e,t){if(e.ok){var n=e.group_channel,r=new(d.default.getInstance().GroupChannel)(n);t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleGroupChannelLeavePub",value:function(e){if(e.ok){var t=e.group_channel,n=e.users,r=new(d.default.getInstance().GroupChannel)(t);d.default.getInstance().GroupChannel.cachedChannels||(d.default.getInstance().GroupChannel.cachedChannels=[]),d.default.getInstance().GroupChannel.cachedChannels[r.getId()]=r;for(var o in d.default.getInstance().getChannelListenersMap()){var s=d.default.getInstance().getChannelListenersMap()[o];for(var i in n){var a=new I.default(n[i]);s.onGroupChannelParticipantLeft(r,a)}}}}},{key:"_handleGroupChannelCreated",value:function(e,t){if(e.ok){var n=e.group_channel,r=new(d.default.getInstance().GroupChannel)(n);t&&this.client.emit("to."+t,r)}}},{key:"_handleGroupChannelHistory",value:function(e,t){if(e.ok){var n=e.messages,r=[];for(var o in n){var s=new m.default(n[o]);r.push(s)}t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleGroupChannelInfo",value:function(e,t){if(e.ok){var n=e.group_channel,r=new(d.default.getInstance().GroupChannel)(n);t&&this.client.emit("to."+t+".success",r)}else{e.error;t&&this.client.emit("to."+t+".error",e.error)}}},{key:"_handleGroupChannelUpdatePub",value:function(e){if(e.ok){var t=e.group_channel,n=new(d.default.getInstance().GroupChannel)(t);d.default.getInstance().GroupChannel.cachedChannels||(d.default.getInstance().GroupChannel.cachedChannels=[]),d.default.getInstance().GroupChannel.cachedChannels[n.getId()]=n,d.default.getInstance().GroupChannel.get(n.getId(),function(e,t){for(var n in d.default.getInstance().getChannelListenersMap()){d.default.getInstance().getChannelListenersMap()[n].onGroupChannelUpdated(t)}})}}},{key:"_handleGroupChannelMyList",value:function(e,t){if(e.ok){var n=e.group_channels,r=[];for(var o in n){var s=new(d.default.getInstance().GroupChannel)(n[o]);r.push(s)}t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleGroupChannelMessageSent",value:function(e,t){if(e.ok){var n=e.message,r=new m.default(n);n.channel_id;t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleGroupChannelMessage",value:function(e,t){if(e.ok){var n=e.message,r=new m.default(n),o=n.channel_id;d.default.getInstance().GroupChannel.get(o,function(e,t){t.lastMessage=r,d.default.getInstance().user.id!==r.user.id&&(t.unreadMessageCount+=1),d.default.getInstance().GroupChannel.cachedChannels||(d.default.getInstance().GroupChannel.cachedChannels=[]),d.default.getInstance().GroupChannel.cachedChannels[t.getId()]=t;for(var n in d.default.getInstance().getChannelListenersMap()){var o=d.default.getInstance().getChannelListenersMap()[n];o.onGroupChannelMessageReceived(t,r),o.onGroupChannelUpdated(t)}})}}},{key:"_handleGroupChannelStartTypingPub",value:function(e,t){if(e.ok){var n=e.group_channel.typing_participant_id,r=e.group_channel.id;d.default.getInstance().GroupChannel.get(r,function(e,t){t.setTypingStatus(n,!0);for(var r in d.default.getInstance().getChannelListenersMap()){d.default.getInstance().getChannelListenersMap()[r].onGroupChannelTypingStatusChanged(t)}})}}},{key:"_handleGroupChannelStopTypingPub",value:function(e,t){if(e.ok){var n=e.group_channel.typing_participant_id,r=e.group_channel.id;d.default.getInstance().GroupChannel.get(r,function(e,t){t.setTypingStatus(n,!1);for(var r in d.default.getInstance().getChannelListenersMap()){d.default.getInstance().getChannelListenersMap()[r].onGroupChannelTypingStatusChanged(t)}})}}},{key:"_handleGroupChannelReadAck",value:function(e,t){if(e.ok){d.default.getInstance().GroupChannel.cachedChannels||(d.default.getInstance().GroupChannel.cachedChannels=[]);var n=e.group_channel,r=new(d.default.getInstance().GroupChannel)(n);d.default.getInstance().GroupChannel.cachedChannels[r.getId()]=r,d.default.getInstance().GroupChannel.get(r.getId(),function(e,t){for(var n in d.default.getInstance().getChannelListenersMap()){d.default.getInstance().getChannelListenersMap()[n].onGroupChannelUpdated(t)}})}}},{key:"_handleGroupChannelReadPub",value:function(e){if(e.ok){d.default.getInstance().GroupChannel.cachedChannels||(d.default.getInstance().GroupChannel.cachedChannels=[]);var t=e.group_channel;d.default.getInstance().GroupChannel.cachedChannels[t.id]&&(t.unread_message_count=d.default.getInstance().GroupChannel.cachedChannels[t.id].unreadMessageCount);var n=new(d.default.getInstance().GroupChannel)(t);d.default.getInstance().GroupChannel.cachedChannels[n.getId()]=n,d.default.getInstance().GroupChannel.get(n.getId(),function(e,t){for(var n in d.default.getInstance().getChannelListenersMap()){d.default.getInstance().getChannelListenersMap()[n].onGroupChannelReadStatusUpdated(t)}})}}},{key:"_handleOpenChannelHistory",value:function(e,t){if(e.ok){var n=e.messages,r=[];for(var o in n){var s=new m.default(n[o]);r.push(s)}t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleOpenChannelInfo",value:function(e,t){if(e.ok){var n=e.open_channel,r=new(d.default.getInstance().OpenChannel)(n);t&&this.client.emit("to."+t+".success",r)}else{e.error;t&&this.client.emit("to."+t+".error",e.error)}}},{key:"_handleOpenChannelJoinAck",value:function(e,t){if(e.ok){var n=e.open_channel,r=new(d.default.getInstance().OpenChannel)(n);t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleOpenChannelJoinPub",value:function(e,t){if(e.ok){var n=e.open_channel,r=e.user,o=new(d.default.getInstance().OpenChannel)(n),s=new I.default(r);for(var i in d.default.getInstance().getChannelListenersMap()){d.default.getInstance().getChannelListenersMap()[i].onOpenChannelParticipantJoined(o,s)}}}},{key:"_handleOpenChannelLeaveAck",value:function(e,t){if(e.ok){var n=e.open_channel,r=new(d.default.getInstance().OpenChannel)(n);t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleOpenChannelLeavePub",value:function(e,t){if(e.ok){var n=e.open_channel,r=e.user,o=new(d.default.getInstance().OpenChannel)(n),s=new I.default(r);for(var i in d.default.getInstance().getChannelListenersMap()){d.default.getInstance().getChannelListenersMap()[i].onOpenChannelParticipantLeft(o,s)}}}},{key:"_handleOpenChannelList",value:function(e,t){if(e.ok){var n=e.open_channels,r=[];for(var o in n){var s=new(d.default.getInstance().OpenChannel)(n[o]);r.push(s)}t&&this.client.emit("to."+t+".success",r)}}},{key:"_handleOpenChannelMessageSent",value:function(e,t){if(e.ok){var n=e.message,r=new m.default(n);n.channel_id;t&&this.client.emit("to."+t,r)}}},{key:"_handleOpenChannelMessage",value:function(e,t){if(e.ok){var n=e.message,r=new m.default(n),o=n.channel_id;d.default.getInstance().OpenChannel.get(o,function(e,t){for(var n in d.default.getInstance().getChannelListenersMap()){d.default.getInstance().getChannelListenersMap()[n].onOpenChannelMessageReceived(t,r)}})}}},{key:"_handleInboxInfo",value:function(e){e.d.ok&&(this.client.inbox.setInbox(e.d.inbox),this.client.emit(e.t,e.d))}},{key:"_handleInboxUpdate",value:function(e){e.d.ok&&(this.client.inbox.updateInbox(e.d.inbox),this.client.emit(e.t,e.d))}},{key:"_handleMessageDm",value:function(e){var t=this;if(e.d.ok){var n=!1;if(this.client.dms[e.d.message.thread_id]){n=!0;var r=!1,o=0;for(var s in this.client.dms[e.d.message.thread_id].messages)if(this.client.dms[e.d.message.thread_id].messages[s].id===e.d.message.id){r=!0,o=s;break}if(e.to)r&&this.client.dms[e.d.message.thread_id].messages.splice(o,1),this.client.emit("to."+e.to,e.d,e.to);else if(!r){var i={client:this.client,_receivedFromServer:!0,id:e.d.message.id,thread:this.client.dms[e.d.message.thread_id],text:e.d.message.text,sender:e.d.message.sender,type:"dm",insertedAt:e.d.message.inserted_at},a=new m.default(i);a.playSound(),this.client.dms[e.d.message.thread_id].typingIndicatorListener.reset(),this.client.titleBlink.changeTitle(e.d.message.sender.user_name,e.d.message.text),this.client.emit("message.dm",e.d)}}if(!n){var u=this.client.transportManager.send({t:"dm.info",d:{id:e.d.message.thread_id}});this.toFunc=function(e,n){t.client.dms[e.dm.id].getHistory(),t.client.user.setWindowState(e.dm.id,"dm","open"),window.setTimeout(function(){t.client.off("to."+n,t.toFunc)},0)},this.client.on("to."+u,this.toFunc)}}}},{key:"_handleMessageRooms",value:function(e){if(e.d.ok){if(this.client.rooms[e.d.message.thread_id]){!0;var t=!1,n=0;for(var r in this.client.rooms[e.d.message.thread_id].messages)if(this.client.rooms[e.d.message.thread_id].messages[r].id===e.d.message.id){t=!0,n=r;break}if(e.to)t&&this.client.rooms[e.d.message.thread_id].messages.splice(n,1),this.client.emit("to."+e.to,e.d);else if(!t){var o={client:this.client,_receivedFromServer:!0,id:e.d.message.id,thread:this.client.rooms[e.d.message.thread_id],text:e.d.message.text,sender:e.d.message.sender,type:"room",insertedAt:e.d.message.inserted_at},s=new m.default(o);e.d.message.sender.id!==this.client.user.id&&(s.playSound(),this.client.titleBlink.changeTitle(e.d.message.sender.user_name,e.d.message.text)),this.client.rooms[e.d.message.thread_id].typingIndicatorListener.reset(),this.client.emit("message.room",e.d)}}}}},{key:"_handleOnlineUsersInfo",value:function(e){e.d.ok&&(this.client.onlineUsers.setList(e.d.list),this.client.emit(e.t,e.d))}},{key:"_handleOnlineUsersJoin",value:function(e){e.d.ok&&(this.client.onlineUsers.joinList(e.d.user),this.client.emit("onlineUsers.info",{ok:!0,list:this.client.onlineUsers.getList()}))}},{key:"_handleOnlineUsersLeave",value:function(e){e.d.ok&&(this.client.onlineUsers.leaveList(e.d.user),this.client.emit("onlineUsers.info",{ok:!0,list:this.client.onlineUsers.getList()}))}},{key:"_handleRoomsList",value:function(e){if(e.d.ok)for(var t in e.d.rooms){var n=e.d.rooms[t],r={client:this.client,_receivedFromServer:!0,id:n.id,name:n.name,type:n.type};this.client.rooms[n.id]=new _.default(r);for(var o in this.client.user.windows){var s=this.client.user.windows[o];if("R"===n.type&&"room"===s.type&&n.id===s.id){s.thread=this.client.rooms[n.id],this.client.rooms[n.id].getHistory();break}}}this.client.emit(e.t,e.d)}},{key:"_handleRoomsHistory",value:function(e){if(e.d.ok){for(var t in e.d.rooms.messages)this._setMessageRoom(e.d.rooms.messages[t]);e.d.rooms.messages.length<20?this.client.rooms[e.d.rooms.id].historyComplete=!0:this.client.rooms[e.d.rooms.id].historyComplete=!1}this.client.emit(e.t,e.d)}},{key:"_handleRoomsTyping",value:function(e){if(e.d.ok&&this.client.rooms[e.d.id]&&this.client.user.id!==e.d.typing_users[0].id&&"started"===e.d.state){this.client.rooms[e.d.id].typingIndicatorListener.set(e.d.typing_users),this.client.emit("rooms.typing",e.d)}}},{key:"_handleUsersAuth",value:function(e,t){if(e.ok){this._setUser(e.user),t&&this.client.transportManager._listeners["r_"+t]&&(this.client.transportManager._listeners["r_"+t](null,this.client.user),delete this.client.transportManager._listeners["r_"+t]),this.client.emit("users.auth",this.client.user);var n=d.default.getInstance().getConnectionListenersMap();for(var r in n){n[r].onConnectionChanged(!0)}}}},{key:"_handleUsersInfo",value:function(e,t){e.ok&&e.user.id===this.client.user.id&&(this._setUser(e.user),t&&this.client.emit("to."+t+".success",this.client.user))}},{key:"_handleUsersList",value:function(e,t){if(e.ok){var n=e.users,r=[];for(var o in n){var s=new w.default(n[o]);r.push(s)}t&&this.client.emit("to."+t,r)}}},{key:"_setUser",value:function(e){this.client.user=new w.default(e,this.client)}},{key:"_setMessageRoom",value:function(e){return new m.default({client:this.client,_receivedFromServer:!0,id:e.id,thread:this.client.rooms[e.thread_id],text:e.text,sender:e.sender,type:"room",insertedAt:e.inserted_at})}},{key:"_setMessageDm",value:function(e){return new m.default({client:this.client,_receivedFromServer:!0,id:e.id,thread:this.client.dms[e.thread_id],text:e.text,sender:e.sender,type:"dm",insertedAt:e.inserted_at})}}]),t}(c.default));t.default=S},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),u=r(a),c=n(1),l=(r(c),function(e){function t(e){o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.appId&&(n.id=e.appId),e.id&&(n.id=e.id),e.name&&(n.name=e.name),e.components&&(n.components=e.components),e.notification&&(n.notification=e.notification),e.client&&(n.client=e.client),n}return i(t,e),t}(u.default));t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(4),c=(r(u),n(6)),l=(r(c),n(3)),f=(r(l),n(0)),h=r(f),d=function(e){function t(e){o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.interval=5e3,e.dm?n.dm=e.dm:e.room&&(n.room=e.room),e.users?n.users=e.users:n.users=[],n.lastKeyId=0,n}return i(t,e),a(t,[{key:"set",value:function(e){var t=this;this.lastKeyId&&window.clearTimeout(this.lastKeyId),this.users=e,this.lastKeyId=window.setTimeout(function(){t.lastKeyId=0,t.users=[],t.dm?t.dm.client.emit("dm.typing.off",{id:t.dm.id}):t.room&&t.room.client.emit("rooms.typing.off",{id:t.room.id})},this.interval)}},{key:"reset",value:function(){this.lastKeyId&&window.clearTimeout(this.lastKeyId),this.lastKeyId=0,this.users=[],this.dm?this.dm.client.emit("dm.typing.off",{id:this.dm.id}):this.room&&this.room.client.emit("rooms.typing.off",{id:this.room.id})}}]),t}(h.default);t.default=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),l=n(10),f=(r(l),n(4)),h=(r(f),n(6)),d=(r(h),n(19).TYPING_STATE),p=d.STARTED,g=(d.PAUSED,d.FINISHED),y=function(e){function t(e){o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.dm&&(n.dm=e.dm),e.room&&(n.room=e.room),n.input=null,n.lastKeyId=0,n._handleKeyPress=n._handleKeyPress.bind(n),n._handleKeyDown=n._handleKeyDown.bind(n),n}return i(t,e),a(t,[{key:"setInput",value:function(e){e!==this.input&&(this.removeInput(this.input),this.input=e,this.input.addEventListener("keypress",this._handleKeyPress),this.input.addEventListener("keydown",this._handleKeyDown))}},{key:"removeInput",value:function(e){e&&(e.removeEventListener("keypress",this._handleKeyPress),e.removeEventListener("keydown",this._handleKeyDown),this.input=null)}},{key:"_handleKeyPress",value:function(e){var t=this;this.lastKeyId&&window.clearTimeout(this.lastKeyId),this.lastKeyId=window.setTimeout(function(){t.lastKeyId=0;var e=!t.input.value;t.send(e?g:p)},50)}},{key:"_handleKeyDown",value:function(e){-1!==[8,46,13].indexOf(e.keyCode)&&this._handleKeyPress(e)}},{key:"send",value:function(e){this.dm?this.dm.client.transportManager.send({t:"dm.typing",d:{id:this.dm.id,state:e}}):this.room&&this.room.client.transportManager.send({t:"rooms.typing",d:{id:this.room.id,state:e}})}}]),t}(c.default);t.default=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),l=n(4),f=(r(l),function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.inbox=[],e}return i(t,e),a(t,[{key:"setInbox",value:function(e){for(var t in e)this.inbox.push(e[t])}},{key:"getInbox",value:function(){return this.inbox}},{key:"updateInbox",value:function(e){for(var t in this.inbox)this.inbox[t].id===e.id&&(!0,this.inbox[t]=e,this.inbox.splice(t,1));this.inbox.unshift(e)}}]),t}(c.default));t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),u=r(a),c=n(26),l=r(c),f=n(27),h=r(f),d=n(28),p=r(d),g=n(11),y=r(g),m=n(5),v=r(m),_=function(){function e(t){if(o(this,e),t.id&&(this.id=t.id),t.name&&(this.name=t.name),t.data&&(this.data=t.data),t.avatar_url&&(this.avatarUrl=t.avatar_url),t.participants){this.participants=[];for(var n in t.participants)this.participants.push(new y.default(t.participants[n]))}t.participants_count?this.participantsCount=t.participants_count:this.participantsCount=0,t.custom_filter&&(this.customFilter=t.custom_filter),t.unread_message_count?this.unreadMessageCount=t.unread_message_count:this.unreadMessageCount=0,t.last_message&&(this.lastMessage=new v.default(t.last_message)),t.is_distinct?this.isDistinct=t.is_distinct:this.isDistinct=!1,t.read_receipt&&(this.readReceipt=t.read_receipt),t.is_archive&&(this.isArchive=t.isArchive),t.inserted_at&&(this.insertedAt=this.inserted_at),t.created_by&&(this.createdBy=t.created_by),t.updated_at&&(this.updatedAt=t.updated_at),t.metadata&&(this.metadata=t.metadata),this.cachedParticipantsTypingStatus=[],this.lastStartTyping=0,this.lastStopTyping=0}return i(e,[{key:"sync",value:function(e){var t=this,n=u.default.getInstance().transportManager.send({t:"group_channels.get",d:{id:this.id}});return this.toSuccessFunc=function(r){return u.default.getInstance().GroupChannel.cachedChannels[r.getId()]=r,window.setTimeout(function(){u.default.getInstance().off("to."+n+".success",t.toSuccessFunc),u.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(null,r)},this.toErrorFunc=function(r){var o=new l.default(r);return window.setTimeout(function(){u.default.getInstance().off("to."+n+".success",t.toSuccessFunc),u.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(o,null)},u.default.getInstance().on("to."+n+".success",this.toSuccessFunc),u.default.getInstance().on("to."+n+".error",this.toErrorFunc),!0}},{key:"inviteParticipants",value:function(e,t){var n=this,r=u.default.getInstance().transportManager.send({t:"group_channels.invite",d:{id:this.id,participant_ids:e}});return this.toSuccessFunc=function(e){return window.setTimeout(function(){u.default.getInstance().off("to."+r+".success",n.toSuccessFunc),u.default.getInstance().off("to."+r+".error",n.toErrorFunc)},0),t(null)},this.toErrorFunc=function(e){new l.default(e);return window.setTimeout(function(){u.default.getInstance().off("to."+r+".success",n.toSuccessFunc),u.default.getInstance().off("to."+r+".error",n.toErrorFunc)},0),t(e)},u.default.getInstance().on("to."+r+".success",this.toSuccessFunc),u.default.getInstance().on("to."+r+".error",this.toErrorFunc),!0}},{key:"inviteParticipant",value:function(e,t){return this.inviteParticipants([e],t)}},{key:"acceptInvitation",value:function(e){var t=this,n=u.default.getInstance().transportManager.send({t:"group_channels.accept",d:{id:this.id}});return this.toSuccessFunc=function(r){return window.setTimeout(function(){u.default.getInstance().off("to."+n+".success",t.toSuccessFunc),u.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(null)},this.toErrorFunc=function(r){new l.default(r);return window.setTimeout(function(){u.default.getInstance().off("to."+n+".success",t.toSuccessFunc),u.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(r)},u.default.getInstance().on("to."+n+".success",this.toSuccessFunc),u.default.getInstance().on("to."+n+".error",this.toErrorFunc),!0}},{key:"leave",value:function(e){var t=this,n=u.default.getInstance().transportManager.send({t:"group_channels.leave",d:{id:this.id}});return this.toSuccessFunc=function(r){return window.setTimeout(function(){u.default.getInstance().off("to."+n+".success",t.toSuccessFunc),u.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(null)},this.toErrorFunc=function(r){new l.default(r);return window.setTimeout(function(){u.default.getInstance().off("to."+n+".success",t.toSuccessFunc),u.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(r)},u.default.getInstance().on("to."+n+".success",this.toSuccessFunc),u.default.getInstance().on("to."+n+".error",this.toErrorFunc),!0}},{key:"declineInvitation",value:function(e){var t=this,n=u.default.getInstance().transportManager.send({t:"group_channels.decline",d:{id:this.id}});return this.toSuccessFunc=function(r){return window.setTimeout(function(){u.default.getInstance().off("to."+n+".success",t.toSuccessFunc),u.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(null)},this.toErrorFunc=function(r){new l.default(r);return window.setTimeout(function(){u.default.getInstance().off("to."+n+".success",t.toSuccessFunc),u.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(r)},u.default.getInstance().on("to."+n+".success",this.toSuccessFunc),u.default.getInstance().on("to."+n+".error",this.toErrorFunc),!0}},{key:"sendMessage",value:function(e,t,n,r){return r?this._sendMessage({message:e,metadata:t,customType:n},r):n?this._sendMessage({message:e,metadata:t},n):!!t&&this._sendMessage({message:e},t)}},{key:"_sendMessage",value:function(e,t){var n=this,r={id:this.id,text:e.message,type:"text"};e.metadata&&(r.metadata=e.metadata),e.customType&&(r.custom_type=e.customType);var o=u.default.getInstance().transportManager.send({t:"group_channels.message",d:r});return this.toSuccessFunc=function(e){return n._markAsRead(),window.setTimeout(function(){u.default.getInstance().off("to."+o+".success",n.toSuccessFunc),u.default.getInstance().off("to."+o+".error",n.toErrorFunc)},0),t(null,e)},this.toErrorFunc=function(e){var r=new l.default(e);return window.setTimeout(function(){u.default.getInstance().off("to."+o+".success",n.toSuccessFunc),u.default.getInstance().off("to."+o+".error",n.toErrorFunc)},0),t(r,null)},u.default.getInstance().on("to."+o+".success",this.toSuccessFunc),u.default.getInstance().on("to."+o+".error",this.toErrorFunc),!0}},{key:"sendAttachment",value:function(e,t,n){var r=this;u.default.getInstance()._uploadAttachment(e,"group_channel",this.id,t,function(e,t){if(e)return n(e,null);var o=u.default.getInstance().transportManager.send({t:"group_channels.message",d:{id:r.id,type:"attachment",attachment:t}});return r.toSuccessFunc=function(e){return r._markAsRead(),window.setTimeout(function(){u.default.getInstance().off("to."+o+".success",r.toSuccessFunc),u.default.getInstance().off("to."+o+".error",r.toErrorFunc)},0),n(null,e)},r.toErrorFunc=function(e){var t=new l.default(e);return window.setTimeout(function(){u.default.getInstance().off("to."+o+".success",r.toSuccessFunc),u.default.getInstance().off("to."+o+".error",r.toErrorFunc)},0),n(t,null)},u.default.getInstance().on("to."+o+".success",r.toSuccessFunc),u.default.getInstance().on("to."+o+".error",r.toErrorFunc),!0})}},{key:"isTyping",value:function(){return Object.keys(this.cachedParticipantsTypingStatus).length>0}},{key:"setTypingStatus",value:function(e,t){t?this.cachedParticipantsTypingStatus[e]=(new Date).getTime():delete this.cachedParticipantsTypingStatus[e]}},{key:"checkTypingStatus",value:function(){var e=!1;for(var t in this.cachedParticipantsTypingStatus)this.cachedParticipantsTypingStatus[t]<(new Date).getTime()-1e4&&(delete this.cachedParticipantsTypingStatus[t],e=!0);return e}},{key:"startTyping",value:function(){var e=this;if(this.lastStartTyping<(new Date).getTime()-1e4){var t=u.default.getInstance().transportManager.send({t:"group_channels.start_typing",d:{id:this.id}});return this.toFunc=function(n){return window.setTimeout(function(){u.default.getInstance().off("to."+t,e.toFunc)},0),cb(null,n)},this.lastStartTyping=(new Date).getTime(),!0}}},{key:"stopTyping",value:function(){var e=this;if(this.lastStopTyping<(new Date).getTime()-1e4){var t=u.default.getInstance().transportManager.send({t:"group_channels.stop_typing",d:{id:this.id}});return this.toFunc=function(n){return window.setTimeout(function(){u.default.getInstance().off("to."+t,e.toFunc)},0),cb(null,n)},this.lastStopTyping=(new Date).getTime(),!0}}},{key:"markAsRead",value:function(){return 0!==this.unreadMessageCount&&this._markAsRead(),!0}},{key:"_markAsRead",value:function(){var e=this,t=u.default.getInstance().transportManager.send({t:"group_channels.read",d:{id:this.id}});return this.toFunc=function(n){return window.setTimeout(function(){u.default.getInstance().off("to."+t,e.toFunc)},0),cb(null,n)},!0}},{key:"getReadReceipt",value:function(e){return this.readReceipt}},{key:"getUnreadMessageCount",value:function(){return this.unreadMessageCount}},{key:"getCurrentUserReadStatus",value:function(){if(this.lastMessage){var e=this.lastMessage.inserted_at;return this.readReceipt[u.default.getInstance().user.id]>=e}return!0}},{key:"getTypingParticipants",value:function(){var e=[];for(var t in this.cachedParticipantsTypingStatus)for(var n in this.participants)if(t===this.participants[n].id){e.push(this.participants[n]);break}return e}}],[{key:"create",value:function(){4==arguments.length?"string"==typeof arguments[0]&&"object"===s(arguments[1])&&s("boolean"===arguments[2])&&s("function"==arguments[3])&&this._create4(arguments[0],arguments[1],arguments[2],arguments[3]):5===arguments.length&&"string"==typeof arguments[0]&&"object"===s(arguments[1])&&s("boolean"===arguments[2])&&"object"===s(arguments[1])&&s("function"==arguments[4])&&this._create5(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},{key:"_create4",value:function(e,t,n,r){var o=this,s=u.default.getInstance().transportManager.send({t:"group_channels.create",d:{name:e,participant_ids:t,is_distinct:n}});return this.toFunc=function(e){return u.default.getInstance().GroupChannel.cachedChannels||(u.default.getInstance().GroupChannel.cachedChannels=[]),u.default.getInstance().GroupChannel.cachedChannels[e.getId()]=e,window.setTimeout(function(){u.default.getInstance().off("to."+s,o.toFunc)},0),r(null,e)},u.default.getInstance().on("to."+s,this.toFunc),!0}},{key:"_create5",value:function(e,t,n,r,o){var s=this,i=u.default.getInstance().transportManager.send({t:"group_channels.create",d:{name:e,participant_ids:t,is_distinct:n,custom_filter:r}});return this.toFunc=function(e){return u.default.getInstance().GroupChannel.cachedChannels||(u.default.getInstance().GroupChannel.cachedChannels=[]),u.default.getInstance().GroupChannel.cachedChannels[e.getId()]=e,window.setTimeout(function(){u.default.getInstance().off("to."+i,s.toFunc)},0),o(null,e)},u.default.getInstance().on("to."+i,this.toFunc),!0}},{key:"get",value:function(e,t){return u.default.getInstance().GroupChannel.cachedChannels&&u.default.getInstance().GroupChannel.cachedChannels[e]?t(null,u.default.getInstance().GroupChannel.cachedChannels[e]):this._getFromServer(e,t)}},{key:"_getFromServer",value:function(e,t){var n=this,r=u.default.getInstance().transportManager.send({t:"group_channels.get",d:{id:e}});return this.toSuccessFunc=function(e){return u.default.getInstance().GroupChannel.cachedChannels||(u.default.getInstance().GroupChannel.cachedChannels=[]),u.default.getInstance().GroupChannel.cachedChannels[e.getId()]=e,window.setTimeout(function(){u.default.getInstance().off("to."+r+".success",n.toSuccessFunc),u.default.getInstance().off("to."+r+".error",n.toErrorFunc)},0),t(null,e)},this.toErrorFunc=function(e){var o=new l.default(e);return window.setTimeout(function(){u.default.getInstance().off("to."+r+".success",n.toSuccessFunc),u.default.getInstance().off("to."+r+".error",n.toErrorFunc)},0),t(o,null)},u.default.getInstance().on("to."+r+".success",this.toSuccessFunc),u.default.getInstance().on("to."+r+".error",this.toErrorFunc),!0}}]),i(e,[{key:"getId",value:function(){return this.id}},{key:"getName",value:function(){return this.name}},{key:"createPreviousMessageListQuery",value:function(){return new p.default(this)}},{key:"refresh",value:function(){}}],[{key:"createGroupChannelListQuery",value:function(){return new h.default}}]),e}();t.default=_},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(t){r(this,e),this.code=t.code,this.message=t.message}return o(e,[{key:"getMessage",value:function(){return this.message}},{key:"getCode",value:function(){return this.code}}]),e}();t.default=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),i=function(e){return e&&e.__esModule?e:{default:e}}(s),a=function(){function e(){r(this,e),this.participantStateFilter=e.PARTICIPANT_STATE_ALL,this.limit=20,this.order=e.RECENT_CHAT}return o(e,[{key:"setParticipantState",value:function(e){this.participantStateFilter=e}},{key:"setReference",value:function(e){this.reference=e}},{key:"get",value:function(e){var t=this,n=i.default.getInstance().transportManager.send({t:"group_channels.my_list",d:{participant_state_filter:this.participantStateFilter,reference:this.reference,limit:this.limit,order:this.order,custom_filter:this.customFilter,custom_filter_query_type:this.customFilterQueryType,custom_filter_search:this.customFilterSearch,channel_ids_filter:this.channelIdsFilter,channel_name_search:this.channelNameSearch,user_ids_all_filter:this.userIdsAllFilter,user_ids_filter_search:this.userIdsFilterSearch,user_ids_filter_search_query_type:this.userIdsFilterSearchQueryType,user_name_search:this.userNameSearch}});return this.toSuccessFunc=function(r){return window.setTimeout(function(){i.default.getInstance().off("to."+n+".success",t.toSuccessFunc),i.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(null,r)},this.toErrorFunc=function(r){var o=new ChatCampException(r);return window.setTimeout(function(){i.default.getInstance().off("to."+n+".success",t.toSuccessFunc),i.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(o,null)},i.default.getInstance().on("to."+n+".success",this.toSuccessFunc),i.default.getInstance().on("to."+n+".error",this.toErrorFunc),!0}}]),e}();a.PARTICIPANT_STATE_ALL="ALL",a.PARTICIPANT_STATE_INVITED="INVITED",a.PARTICIPANT_STATE_ACCEPTED="ACCEPTED",a.RECENT_CHAT="RECENT_CHAT",a.CHRONOLOGICAL="CHRONOLOGICAL",a.ALPHABETICAL="ALPHABETICAL",a.QUERY_TYPE_AND="AND",a.QUERY_TYPE_OR="OR",t.default=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),a=r(i),u=n(25),c=r(u),l=function(){function e(t){o(this,e),t instanceof c.default?(this.channelType="group",this.groupChannel=t):(this.channelType="open",this.openChannel=t)}return s(e,[{key:"load",value:function(e,t,n){var r=this,o=void 0;return"open"==this.channelType?o=a.default.getInstance().transportManager.send({t:"open_channels.history",d:{id:this.openChannel.getId(),limit:e,reference:t}}):"group"==this.channelType&&(o=a.default.getInstance().transportManager.send({t:"group_channels.history",d:{id:this.groupChannel.getId(),limit:e,reference:t}})),this.toSuccessFunc=function(e){return window.setTimeout(function(){a.default.getInstance().off("to."+o+".success",r.toSuccessFunc)},0),n(null,e)},a.default.getInstance().on("to."+o+".success",this.toSuccessFunc),!0}}]),e}();t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),i=function(e){return e&&e.__esModule?e:{default:e}}(s),a=function(){function e(){r(this,e),this.limit=20}return o(e,[{key:"get",value:function(e){var t=this,n=i.default.getInstance().transportManager.send({t:"open_channels.list",d:{reference:this.reference,limit:this.limit}});return this.toSuccessFunc=function(r){return window.setTimeout(function(){i.default.getInstance().off("to."+n+".success",t.toSuccessFunc),i.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(null,r)},this.toErrorFunc=function(r){var o=new ChatCampException(r);return window.setTimeout(function(){i.default.getInstance().off("to."+n+".success",t.toSuccessFunc),i.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(o,null)},i.default.getInstance().on("to."+n+".success",this.toSuccessFunc),i.default.getInstance().on("to."+n+".error",this.toErrorFunc),!0}}]),e}();t.default=a},function(e,t,n){"use strict";var r=n(1).default;e.exports=r},function(e,t,n){"use strict";function r(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map(function(e){e(n)}),(e["*"]||[]).slice().map(function(e){e(t,n)})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";function r(e){var t=new i(e),n=s(i.prototype.request,t);return o.extend(n,i.prototype,t),o.extend(n,t),n}var o=n(2),s=n(13),i=n(34),a=n(7),u=r(a);u.Axios=i,u.create=function(e){return r(o.merge(a,e))},u.Cancel=n(17),u.CancelToken=n(49),u.isCancel=n(16),u.all=function(e){return Promise.all(e)},u.spread=n(50),e.exports=u,e.exports.default=u},function(e,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function r(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(n(e)||r(e)||!!e._isBuffer)}},function(e,t,n){"use strict";function r(e){this.defaults=e,this.interceptors={request:new i,response:new i}}var o=n(7),s=n(2),i=n(44),a=n(45),u=n(47),c=n(48);r.prototype.request=function(e){"string"==typeof e&&(e=s.merge({url:arguments[0]},arguments[1])),e=s.merge(o,this.defaults,{method:"get"},e),e.method=e.method.toLowerCase(),e.baseURL&&!u(e.url)&&(e.url=c(e.baseURL,e.url));var t=[a,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},s.forEach(["delete","get","head","options"],function(e){r.prototype[e]=function(t,n){return this.request(s.merge(n||{},{method:e,url:t}))}}),s.forEach(["post","put","patch"],function(e){r.prototype[e]=function(t,n,r){return this.request(s.merge(r||{},{method:e,url:t,data:n}))}}),e.exports=r},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function s(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function i(){g&&d&&(g=!1,d.length?p=d.concat(p):y=-1,p.length&&a())}function a(){if(!g){var e=o(i);g=!0;for(var t=p.length;t;){for(d=p,p=[];++y<t;)d&&d[y].run();y=-1,t=p.length}d=null,g=!1,s(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,f,h=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var d,p=[],g=!1,y=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new u(e,t)),1!==p.length||g||o(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.prependListener=c,h.prependOnceListener=c,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t,n){"use strict";var r=n(2);e.exports=function(e,t){r.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})}},function(e,t,n){"use strict";var r=n(15);e.exports=function(e,t,n){var o=n.config.validateStatus;n.status&&o&&!o(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){"use strict";e.exports=function(e,t,n,r,o){return e.config=t,n&&(e.code=n),e.request=r,e.response=o,e}},function(e,t,n){"use strict";function r(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var o=n(2);e.exports=function(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(o.isURLSearchParams(t))s=t.toString();else{var i=[];o.forEach(t,function(e,t){null!==e&&void 0!==e&&(o.isArray(e)&&(t+="[]"),o.isArray(e)||(e=[e]),o.forEach(e,function(e){o.isDate(e)?e=e.toISOString():o.isObject(e)&&(e=JSON.stringify(e)),i.push(r(t)+"="+r(e))}))}),s=i.join("&")}return s&&(e+=(-1===e.indexOf("?")?"?":"&")+s),e}},function(e,t,n){"use strict";var r=n(2);e.exports=function(e){var t,n,o,s={};return e?(r.forEach(e.split("\n"),function(e){o=e.indexOf(":"),t=r.trim(e.substr(0,o)).toLowerCase(),n=r.trim(e.substr(o+1)),t&&(s[t]=s[t]?s[t]+", "+n:n)}),s):s}},function(e,t,n){"use strict";var r=n(2);e.exports=r.isStandardBrowserEnv()?function(){function e(e){var t=e;return n&&(o.setAttribute("href",t),t=o.href),o.setAttribute("href",t),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:"/"===o.pathname.charAt(0)?o.pathname:"/"+o.pathname}}var t,n=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a");return t=e(window.location.href),function(n){var o=r.isString(n)?e(n):n;return o.protocol===t.protocol&&o.host===t.host}}():function(){return function(){return!0}}()},function(e,t,n){"use strict";function r(){this.message="String contains an invalid character"}function o(e){for(var t,n,o=String(e),i="",a=0,u=s;o.charAt(0|a)||(u="=",a%1);i+=u.charAt(63&t>>8-a%1*8)){if((n=o.charCodeAt(a+=.75))>255)throw new r;t=t<<8|n}return i}var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.prototype=new Error,r.prototype.code=5,r.prototype.name="InvalidCharacterError",e.exports=o},function(e,t,n){"use strict";var r=n(2);e.exports=r.isStandardBrowserEnv()?function(){return{write:function(e,t,n,o,s,i){var a=[];a.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),r.isString(o)&&a.push("path="+o),r.isString(s)&&a.push("domain="+s),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()},function(e,t,n){"use strict";function r(){this.handlers=[]}var o=n(2);r.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){o.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=r},function(e,t,n){"use strict";function r(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var o=n(2),s=n(46),i=n(16),a=n(7);e.exports=function(e){return r(e),e.headers=e.headers||{},e.data=s(e.data,e.headers,e.transformRequest),e.headers=o.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),o.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||a.adapter)(e).then(function(t){return r(e),t.data=s(t.data,t.headers,e.transformResponse),t},function(t){return i(t)||(r(e),t&&t.response&&(t.response.data=s(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,n){"use strict";var r=n(2);e.exports=function(e,t,n){return r.forEach(n,function(n){e=n(e,t)}),e}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new o(e),t(n.reason))})}var o=n(17);r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r(function(t){e=t}),cancel:e}},e.exports=r},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),u=r(a),c=n(18),l=r(c),f=n(12),h=r(f),d=n(52),p=(r(d),n(8)),g=(r(p),n(20)),y=(r(g),function(e){function t(e){o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.devMode=!1,e.devMode&&(n.devMode=e.devMode),n.devMode?n.baseUrl="http://localhost:9080/api/1.0":n.baseUrl="https://api.chatcamp.io/api/1.0",h.default.defaults.withCredentials=!0,e.baseUrl&&(n.baseUrl=e.baseUrl),l.default.level=e.loglevel,n}return i(t,e),t}(u.default));t.default=y},function(e,t,n){var r,o;!function(s){var i=!1;if(r=s,void 0!==(o="function"==typeof r?r.call(t,n,t,e):r)&&(e.exports=o),i=!0,e.exports=s(),i=!0,!i){var a=window.Cookies,u=window.Cookies=s();u.noConflict=function(){return window.Cookies=a,u}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(n){function r(t,o,s){var i;if("undefined"!=typeof document){if(arguments.length>1){if(s=e({path:"/"},r.defaults,s),"number"==typeof s.expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*s.expires),s.expires=a}s.expires=s.expires?s.expires.toUTCString():"";try{i=JSON.stringify(o),/^[\{\[]/.test(i)&&(o=i)}catch(e){}o=n.write?n.write(o,t):encodeURIComponent(String(o)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape);var u="";for(var c in s)s[c]&&(u+="; "+c,!0!==s[c]&&(u+="="+s[c]));return document.cookie=t+"="+o+u}t||(i={});for(var l=document.cookie?document.cookie.split("; "):[],f=/(%[0-9A-Z]{2})+/g,h=0;h<l.length;h++){var d=l[h].split("="),p=d.slice(1).join("=");this.json||'"'!==p.charAt(0)||(p=p.slice(1,-1));try{var g=d[0].replace(f,decodeURIComponent);if(p=n.read?n.read(p,g):n(p,g)||p.replace(f,decodeURIComponent),this.json)try{p=JSON.parse(p)}catch(e){}if(t===g){i=p;break}t||(i[g]=p)}catch(e){}}return i}}return r.set=r,r.get=function(e){return r.call(r,e)},r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,n){r(t,"",e(n,{expires:-1}))},r.withConverter=t,r}return t(function(){})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(54),s=function(e){return e&&e.__esModule?e:{default:e}}(o),i=function(e,t){function n(){var t=0;for(var n in d){if(p===t){var r=d[n]();if(r){var o=new r.transport(e);return o.heart=r.heart,o}p++}t++}return!1}var o=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},i=o(25)+(new Date).getTime(),a=0,u=1,c=2,l=3,f=e.replace("ws:","http:").replace("wss:","https:");if(e===f)if(void 0===t)var t={disableWebSocket:!0};else t.disableWebSocket=!0;var h=function(e){if(this.readyState!==a&&this.readyState!==u)return!1;var t=this;return s.default.post(f,e,{iflychat_token:i,content_type:"application/json"},function(e){e&&0!==e.length&&t.onmessage({data:e})}),!0},d={websocket:function(){var e=null;return(void 0===t||!t.disableWebSocket)&&(window.WebSocket&&(e=window.WebSocket),window.MozWebSocket&&-1===navigator.userAgent.indexOf("Firefox/6.0")&&(e=window.MozWebSocket),e?{heart:!0,transport:e}:null)},eventsource:function(){if(void 0!==t&&t.disableEventSource)return!1;if(!window.EventSource)return!1;var e=new window.EventSource(f);e.onopen=function(){n.readyState=u,n.onopen()},e.onmessage=function(e){n.onmessage(e)},e.onerror=function(){e.close(),e=void 0,n.onerror()};var n={readyState:a,send:h,close:function(){n.readyState=l,e.close(),e=void 0,n.onclose()}};return{heart:!1,transport:function(){return n}}},xhrPolling:function(){function e(){d=s.default.get(f,function(e){if(e){if(d=null,p.readyState===a&&(p.readyState=u,p.onopen(p)),e&&0!==e.length)if("object"===(void 0===e?"undefined":r(e)))for(var t in e)p.onmessage({data:e[t]});else p.onmessage({data:e});p.readyState===u&&n()}else d=null,p.onerror()},{iflychat_token:i})}function n(){c=setTimeout(function(){e()},100)}if(void 0!==t&&t.disableXHRPolling)return!1;var c,d=null;i=o(25)+(new Date).getTime();var p={readyState:a,send:h,close:function(){this.readyState=l,d&&(d.abort(),d=null),clearTimeout(c),p.onclose()},onopen:function(){},onmessage:function(){},onerror:function(){},onclose:function(){}};return n(),{heart:!1,transport:function(){return p}}}},p=0,g=new function(){function t(){if(s=!1,i=a,!(o=y?null:n()))return f=h,p=0,g&&g.ondisconnect(),!1;o.onopen=function(){f=h,o.heart&&(r=setInterval(function(){g.onheartbeat()},2e4)),i!==u&&(i=u,g.onopen(),y=!0)},o.onclose=function(){s||i===l||(o=null,clearInterval(r),i===c?(i=l,o=!1,g.onclose()):(i===a&&p++,f*=2,f>d&&(f=d),s=!0,setTimeout(function(){t()},f)))},o.onerror=o.onclose,o.onmessage=function(e){g.onmessage(e)}}var r,o,s=!0,i=l,f=80,h=80,d=1e4,y=!1;t(),this.onopen=function(){},this.onmessage=function(){},this.ondisconnect=function(){},this.onclose=function(){},this.onheartbeat=function(){},this.setURL=function(t){e=t},this.send=function(e){if(o){var t=o.send(e);return void 0===t||t}return!1},this.close=function(){i=c,o&&o.close()},this.transportType=p};return g};t.default=i},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e){if("object"===(void 0===e?"undefined":r(e))){if(void 0!==e.token)return e=JSON.stringify(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}return e},s=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return!!(t>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&parseInt(e.substring(t+5,e.indexOf(".",t)))},i=function(e,t,n,i){var a=!1;if(s()&&window.XDomainRequest,1){var u=new XMLHttpRequest;u.open("POST",e,!0),u.withCredentials=!0,"application/x-www-form-urlencoded"===n?u.setRequestHeader("Content-type",n):"object"===(void 0===n?"undefined":r(n))?(u.setRequestHeader("Content-type",n.content_type),u.setRequestHeader("X-CSRF-TOKEN",n.csrf_token),n.access_token&&u.setRequestHeader("X-Access-Token",n.access_token),n.iflychat_token&&u.setRequestHeader("iflychat-token",n.iflychat_token),"string"!=typeof t&&"application/json"===n.content_type&&(t=JSON.stringify(t))):(u.setRequestHeader("Content-type","application/json"),"string"!=typeof t&&(t=JSON.stringify(t))),u.ontimeout=function(){a||(a=!0,i(!1))},u.timeout=5e4,u.onerror=function(){a||(a=!0,i(!1))},u.send(t),u.onreadystatechange=function(){if(4===u.readyState&&u.status>=200&&u.status<300)try{var e=JSON.parse(u.responseText);a||(a=!0,i(e))}catch(e){a||(a=!0,i("invalidTokenJSON"))}else 4===u.readyState&&(a||(a=!0,i(!1)))},u.onloadend=function(){}}else{alert(window.XDomainRequest);var c=new XDomainRequest;c.open("POST",e),c.ontimeout=function(){a||(a=!0,i(!1))},c.onprogress=function(){},c.onload=function(){try{var e=JSON.parse(c.responseText);null!=e&&void 0!==e||(e=JSON.parse(t.firstChild.textContent)),a||(a=!0,i(e))}catch(e){a||(a=!0,i("invalidTokenJSON"))}},c.onerror=function(){a||(a=!0,i(!1))},c.timeout=5e4,setTimeout(function(){c.send(o(t))},500)}},a=function(e,t,n){var o=!1;if(s()&&window.XDomainRequest,1){var i=new XMLHttpRequest;i.open("GET",e),i.withCredentials=!0,"object"===(void 0===n?"undefined":r(n))&&(n.iflychat_token&&i.setRequestHeader("iflychat-token",n.iflychat_token),i.setRequestHeader("x-csrf-token",n.csrf_token)),i.ontimeout=function(){o||(o=!0,t(!1))},i.onerror=function(){o||(o=!0,t(!1))},i.timeout=2e5,i.send(),i.onreadystatechange=function(){if(4===i.readyState&&i.status>=200&&i.status<300){var e=JSON.parse(i.responseText);o=!0,t(e)}else 4===i.readyState&&(o||(o=!0,t(!1)))},i.onloadend=function(){}}else{var a=new XDomainRequest;a.open("get",e),a.ontimeout=function(){o||(o=!0,t(!1))},a.onerror=function(){o||(o=!0,t(!1))},a.timeout=2e5,a.onload=function(){var e=JSON.parse(a.responseText);o=!0,t(e)},a.send()}};e.exports={post:i,get:a}},function(e,t,n){(function(t){(function(){"use strict";function t(e){this.tokens=[],this.tokens.links={},this.options=e||f.defaults,this.rules=h.normal,this.options.gfm&&(this.options.tables?this.rules=h.tables:this.rules=h.gfm)}function n(e,t){if(this.options=t||f.defaults,this.links=e,this.rules=d.normal,this.renderer=this.options.renderer||new r,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=d.breaks:this.rules=d.gfm:this.options.pedantic&&(this.rules=d.pedantic)}function r(e){this.options=e||{}}function o(e){this.tokens=[],this.token=null,this.options=e||f.defaults,this.options.renderer=this.options.renderer||new r,this.renderer=this.options.renderer,this.renderer.options=this.options}function s(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function i(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}function a(e,t){return e=e.source,t=t||"",function n(r,o){return r?(o=o.source||o,o=o.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(r,o),n):new RegExp(e,t)}}function u(e,t){return p[" "+e]||(/^[^:]+:\/*[^\/]*$/.test(e)?p[" "+e]=e+"/":p[" "+e]=e.replace(/[^\/]*$/,"")),e=p[" "+e],"//"===t.slice(0,2)?e.replace(/:[\s\S]*/,":")+t:"/"===t.charAt(0)?e.replace(/(:\/*[^\/]*)[\s\S]*/,"$1")+t:e+t}function c(){}function l(e){for(var t,n,r=1;r<arguments.length;r++){t=arguments[r];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}function f(e,n,r){if(r||"function"==typeof n){r||(r=n,n=null),n=l({},f.defaults,n||{});var i,a,u=n.highlight,c=0;try{i=t.lex(e,n)}catch(e){return r(e)}a=i.length;var h=function(e){if(e)return n.highlight=u,r(e);var t;try{t=o.parse(i,n)}catch(t){e=t}return n.highlight=u,e?r(e):r(null,t)};if(!u||u.length<3)return h();if(delete n.highlight,!a)return h();for(;c<i.length;c++)!function(e){"code"!==e.type?--a||h():u(e.text,e.lang,function(t,n){return t?h(t):null==n||n===e.text?--a||h():(e.text=n,e.escaped=!0,void(--a||h()))})}(i[c])}else try{return n&&(n=l({},f.defaults,n)),o.parse(t.lex(e,n),n)}catch(e){if(e.message+="\nPlease report this to https://github.com/chjj/marked.",(n||f.defaults).silent)return"<p>An error occurred:</p><pre>"+s(e.message+"",!0)+"</pre>";throw e}}var h={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:c,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:c,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:c,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};h.bullet=/(?:[*+-]|\d+\.)/,h.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,h.item=a(h.item,"gm")(/bull/g,h.bullet)(),h.list=a(h.list)(/bull/g,h.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+h.def.source+")")(),h.blockquote=a(h.blockquote)("def",h.def)(),h._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",h.html=a(h.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,h._tag)(),h.paragraph=a(h.paragraph)("hr",h.hr)("heading",h.heading)("lheading",h.lheading)("blockquote",h.blockquote)("tag","<"+h._tag)("def",h.def)(),h.normal=l({},h),h.gfm=l({},h.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\s*\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),h.gfm.paragraph=a(h.paragraph)("(?!","(?!"+h.gfm.fences.source.replace("\\1","\\2")+"|"+h.list.source.replace("\\1","\\3")+"|")(),h.tables=l({},h.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),t.rules=h,t.lex=function(e,n){return new t(n).lex(e)},t.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},t.prototype.token=function(e,t,n){for(var r,o,s,i,a,u,c,l,f,e=e.replace(/^ +$/gm,"");e;)if((s=this.rules.newline.exec(e))&&(e=e.substring(s[0].length),s[0].length>1&&this.tokens.push({type:"space"})),s=this.rules.code.exec(e))e=e.substring(s[0].length),s=s[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?s:s.replace(/\n+$/,"")});else if(s=this.rules.fences.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"code",lang:s[2],text:s[3]||""});else if(s=this.rules.heading.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"heading",depth:s[1].length,text:s[2]});else if(t&&(s=this.rules.nptable.exec(e))){for(e=e.substring(s[0].length),u={type:"table",header:s[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:s[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:s[3].replace(/\n$/,"").split("\n")},l=0;l<u.align.length;l++)/^ *-+: *$/.test(u.align[l])?u.align[l]="right":/^ *:-+: *$/.test(u.align[l])?u.align[l]="center":/^ *:-+ *$/.test(u.align[l])?u.align[l]="left":u.align[l]=null;for(l=0;l<u.cells.length;l++)u.cells[l]=u.cells[l].split(/ *\| */);this.tokens.push(u)}else if(s=this.rules.lheading.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"heading",depth:"="===s[2]?1:2,text:s[1]});else if(s=this.rules.hr.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"hr"});else if(s=this.rules.blockquote.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"blockquote_start"}),s=s[0].replace(/^ *> ?/gm,""),this.token(s,t,!0),this.tokens.push({type:"blockquote_end"});else if(s=this.rules.list.exec(e)){for(e=e.substring(s[0].length),i=s[2],this.tokens.push({type:"list_start",ordered:i.length>1}),s=s[0].match(this.rules.item),r=!1,f=s.length,l=0;l<f;l++)u=s[l],c=u.length,u=u.replace(/^ *([*+-]|\d+\.) +/,""),~u.indexOf("\n ")&&(c-=u.length,u=this.options.pedantic?u.replace(/^ {1,4}/gm,""):u.replace(new RegExp("^ {1,"+c+"}","gm"),"")),this.options.smartLists&&l!==f-1&&(a=h.bullet.exec(s[l+1])[0],i===a||i.length>1&&a.length>1||(e=s.slice(l+1).join("\n")+e,l=f-1)),o=r||/\n\n(?!\s*$)/.test(u),l!==f-1&&(r="\n"===u.charAt(u.length-1),o||(o=r)),this.tokens.push({type:o?"loose_item_start":"list_item_start"}),this.token(u,!1,n),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(s=this.rules.html.exec(e))e=e.substring(s[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===s[1]||"script"===s[1]||"style"===s[1]),text:s[0]});else if(!n&&t&&(s=this.rules.def.exec(e)))e=e.substring(s[0].length),this.tokens.links[s[1].toLowerCase()]={href:s[2],title:s[3]};else if(t&&(s=this.rules.table.exec(e))){for(e=e.substring(s[0].length),u={type:"table",header:s[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:s[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:s[3].replace(/(?: *\| *)?\n$/,"").split("\n")},l=0;l<u.align.length;l++)/^ *-+: *$/.test(u.align[l])?u.align[l]="right":/^ *:-+: *$/.test(u.align[l])?u.align[l]="center":/^ *:-+ *$/.test(u.align[l])?u.align[l]="left":u.align[l]=null;for(l=0;l<u.cells.length;l++)u.cells[l]=u.cells[l].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(u)}else if(t&&(s=this.rules.paragraph.exec(e)))e=e.substring(s[0].length),this.tokens.push({type:"paragraph",text:"\n"===s[1].charAt(s[1].length-1)?s[1].slice(0,-1):s[1]});else if(s=this.rules.text.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"text",text:s[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var d={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ <>]+(@|:\/)[^ <>]+)>/,url:c,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^<'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)([\s\S]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:c,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};d._inside=/(?:\[[^\]]*\]|\\[\[\]]|[^\[\]]|\](?=[^\[]*\]))*/,d._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,d.link=a(d.link)("inside",d._inside)("href",d._href)(),d.reflink=a(d.reflink)("inside",d._inside)(),d.normal=l({},d),d.pedantic=l({},d.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),d.gfm=l({},d.normal,{escape:a(d.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:a(d.text)("]|","~]|")("|","|https?://|")()}),d.breaks=l({},d.gfm,{br:a(d.br)("{2,}","*")(),text:a(d.gfm.text)("{2,}","*")()}),n.rules=d,n.output=function(e,t,r){return new n(t,r).output(e)},n.prototype.output=function(e){for(var t,n,r,o,i="";e;)if(o=this.rules.escape.exec(e))e=e.substring(o[0].length),i+=o[1];else if(o=this.rules.autolink.exec(e))e=e.substring(o[0].length),"@"===o[2]?(n=s(":"===o[1].charAt(6)?this.mangle(o[1].substring(7)):this.mangle(o[1])),r=this.mangle("mailto:")+n):(n=s(o[1]),r=n),i+=this.renderer.link(r,null,n);else if(this.inLink||!(o=this.rules.url.exec(e))){if(o=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(o[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(o[0])&&(this.inLink=!1),e=e.substring(o[0].length),i+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(o[0]):s(o[0]):o[0];else if(o=this.rules.link.exec(e))e=e.substring(o[0].length),this.inLink=!0,i+=this.outputLink(o,{href:o[2],title:o[3]}),this.inLink=!1;else if((o=this.rules.reflink.exec(e))||(o=this.rules.nolink.exec(e))){if(e=e.substring(o[0].length),t=(o[2]||o[1]).replace(/\s+/g," "),!(t=this.links[t.toLowerCase()])||!t.href){i+=o[0].charAt(0),e=o[0].substring(1)+e;continue}this.inLink=!0,i+=this.outputLink(o,t),this.inLink=!1}else if(o=this.rules.strong.exec(e))e=e.substring(o[0].length),i+=this.renderer.strong(this.output(o[2]||o[1]));else if(o=this.rules.em.exec(e))e=e.substring(o[0].length),i+=this.renderer.em(this.output(o[2]||o[1]));else if(o=this.rules.code.exec(e))e=e.substring(o[0].length),i+=this.renderer.codespan(s(o[2].trim(),!0));else if(o=this.rules.br.exec(e))e=e.substring(o[0].length),i+=this.renderer.br();else if(o=this.rules.del.exec(e))e=e.substring(o[0].length),i+=this.renderer.del(this.output(o[1]));else if(o=this.rules.text.exec(e))e=e.substring(o[0].length),i+=this.renderer.text(s(this.smartypants(o[0])));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else e=e.substring(o[0].length),n=s(o[1]),r=n,i+=this.renderer.link(r,null,n);return i},n.prototype.outputLink=function(e,t){var n=s(t.href),r=t.title?s(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(n,r,this.output(e[1])):this.renderer.image(n,r,s(e[1]))},n.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014\/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014\/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):e},n.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,n="",r=e.length,o=0;o<r;o++)t=e.charCodeAt(o),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},r.prototype.code=function(e,t,n){if(this.options.highlight){var r=this.options.highlight(e,t);null!=r&&r!==e&&(n=!0,e=r)}return t?'<pre><code class="'+this.options.langPrefix+s(t,!0)+'">'+(n?e:s(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:s(e,!0))+"\n</code></pre>"},r.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},r.prototype.html=function(e){return e},r.prototype.heading=function(e,t,n){return"<h"+t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},r.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},r.prototype.list=function(e,t){var n=t?"ol":"ul";return"<"+n+">\n"+e+"</"+n+">\n"},r.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},r.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},r.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},r.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},r.prototype.tablecell=function(e,t){var n=t.header?"th":"td";return(t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">")+e+"</"+n+">\n"},r.prototype.strong=function(e){return"<strong>"+e+"</strong>"},r.prototype.em=function(e){return"<em>"+e+"</em>"},r.prototype.codespan=function(e){return"<code>"+e+"</code>"},r.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},r.prototype.del=function(e){return"<del>"+e+"</del>"},r.prototype.link=function(e,t,n){if(this.options.sanitize){try{var r=decodeURIComponent(i(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return n}if(0===r.indexOf("javascript:")||0===r.indexOf("vbscript:")||0===r.indexOf("data:"))return n}this.options.baseUrl&&!g.test(e)&&(e=u(this.options.baseUrl,e));var o='<a href="'+e+'"';return t&&(o+=' title="'+t+'"'),o+=">"+n+"</a>"},r.prototype.image=function(e,t,n){this.options.baseUrl&&!g.test(e)&&(e=u(this.options.baseUrl,e));var r='<img src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+=this.options.xhtml?"/>":">"},r.prototype.text=function(e){return e},o.parse=function(e,t,n){return new o(t,n).parse(e)},o.prototype.parse=function(e){this.inline=new n(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var t="";this.next();)t+=this.tok();return t},o.prototype.next=function(){return this.token=this.tokens.pop()},o.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},o.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},o.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,n,r,o="",s="";for(n="",e=0;e<this.token.header.length;e++)({header:!0,align:this.token.align[e]}),n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(o+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",r=0;r<t.length;r++)n+=this.renderer.tablecell(this.inline.output(t[r]),{header:!1,align:this.token.align[r]});s+=this.renderer.tablerow(n)}return this.renderer.table(o,s);case"blockquote_start":for(var s="";"blockquote_end"!==this.next().type;)s+=this.tok();return this.renderer.blockquote(s);case"list_start":for(var s="",i=this.token.ordered;"list_end"!==this.next().type;)s+=this.tok();return this.renderer.list(s,i);case"list_item_start":for(var s="";"list_item_end"!==this.next().type;)s+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(s);case"loose_item_start":for(var s="";"list_item_end"!==this.next().type;)s+=this.tok();return this.renderer.listitem(s);case"html":var a=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(a);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}};var p={},g=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;c.exec=c,f.options=f.setOptions=function(e){return l(f.defaults,e),f},f.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new r,xhtml:!1,baseUrl:null},f.Parser=o,f.parser=o.parse,f.Renderer=r,f.Lexer=t,f.lexer=t.lex,f.InlineLexer=n,f.inlineLexer=n.output,f.parse=f,e.exports=f}).call(function(){return this||("undefined"!=typeof window?window:t)}())}).call(t,n(56))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),l=n(3),f=r(l),h=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.onlineUsers={global:{users:[]}},e}return i(t,e),a(t,[{key:"setList",value:function(e){for(var t in e)this.onlineUsers.global.users.push(this.transform(e[t]))}},{key:"getList",value:function(){return this.onlineUsers.global.users}},{key:"joinList",value:function(e){for(var t=0;t<this.onlineUsers.global.users.length&&this.onlineUsers.global.users[t].id!==e.id;t++){if(e.user_name.toUpperCase()<this.onlineUsers.global.users[t].userName.toUpperCase()){this.onlineUsers.global.users.splice(t,0,this.transform(e));break}if(t===this.onlineUsers.global.users.length-1){this.onlineUsers.global.users.splice(t+1,0,this.transform(e));break}}}},{key:"leaveList",value:function(e){for(var t=0;t<this.onlineUsers.global.users.length;t++)if(this.onlineUsers.global.users[t].id===e.id){this.onlineUsers.global.users.splice(t,1);break}}},{key:"transform",value:function(e){return new f.default({id:e.id,type:e.type,status:e.status,appId:e.app_id,userName:e.user_name,email:e.email,avatarUrl:e.avatar_url})}}]),t}(c.default);t.default=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),u=function(e){return e&&e.__esModule?e:{default:e}}(a),c=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e&&(n.name=e.name,n.title=e.title,n.oldTitle=e.oldTitle,n.interval=e.interval,n.isOldTitle=e.isOldTitle,n.client=e.client),window.onfocus=function(){this.clearTitle()}.bind(n),n}return s(t,e),i(t,[{key:"changeTitle",value:function(e,t){var n=this;this.name=e,this.title=t,"string"!=typeof this.title&&(this.title=this.title.join(" ")),this.title=this.name+" says: "+this.title.substring(0,8)+"...",null!==this.interval?(clearInterval(this.interval),this.interval=null,document.title=this.oldTitle,this.interval=setInterval(function(){document.title=n.isOldTitle?n.oldTitle:n.title,n.isOldTitle=!n.isOldTitle},2e3)):this.interval=setInterval(function(){document.title=n.isOldTitle?n.oldTitle:n.title,n.isOldTitle=!n.isOldTitle},2e3)}},{key:"clearTitle",value:function(){clearInterval(this.interval),this.interval=null,document.title=this.oldTitle}}]),t}(u.default);t.default=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(){r(this,e),this.onGroupChannelMessageReceived=function(e,t){},this.onGroupChannelTypingStatusChanged=function(e){},this.onGroupChannelReadStatusUpdated=function(e){},this.onGroupChannelUpdated=function(e){},this.onGroupChannelParticipantJoined=function(e,t){},this.onGroupChannelParticipantLeft=function(e,t){},this.onGroupChannelParticipantInvited=function(e,t){},this.onGroupChannelParticipantDeclined=function(e,t){},this.onOpenChannelMessageReceived=function(e,t){},this.onOpenChannelParticipantJoined=function(e,t){},this.onOpenChannelParticipantLeft=function(e,t){},this.onOpenChannelTypingStatusChanged=function(e){}};t.default=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),i=function(e){return e&&e.__esModule?e:{default:e}}(s),a=function(){function e(){r(this,e),this.limit=20,this.isActiveFilter=e.IS_ACTIVE_FILTER_ACTIVE,this.isOnlineFilter=e.IS_ONLINE_FILTER_ALL,this.order=e.ORDER_ALPHABETICAL}return o(e,[{key:"load",value:function(e){var t=this,n=void 0;return n=i.default.getInstance().transportManager.send({t:"users.list",d:{limit:this.limit,reference:this.reference,user_ids:this.userIds,is_active_filter:this.isActiveFilter,is_online_filter:this.isOnlineFilter,custom_filter:this.customFilter,custom_filter_query_type:this.customFilterQueryType,display_name_search:this.displayNameSearch,order:this.order}}),this.toFunc=function(r){return window.setTimeout(function(){i.default.getInstance().off("to."+n,t.toFunc)},0),r.length>0&&(t.reference=r[r.length-1].id),e(null,r)},i.default.getInstance().on("to."+n,this.toFunc),!0}}]),e}();t.default=a,a.IS_ACTIVE_FILTER_ACTIVE="ACTIVE",a.IS_ACTIVE_FILTER_DEACTIVE="DEACTIVE",a.IS_ACTIVE_FILTER_ALL="ALL",a.IS_ONLINE_FILTER_ONLINE="ONLINE",a.IS_ONLINE_FILTER_OFFLINE="OFFLINE",a.IS_ONLINE_FILTER_ALL="ALL",a.ORDER_CHRONOLOGICAL="CHRONOLOGICAL",a.ORDER_ALPHABETICAL="ALPHABETICAL"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),a=r(i),u=n(26),c=r(u),l=n(29),f=r(l),h=n(28),d=r(h),p=n(11),g=r(p),y=n(5),m=r(y),v=function(){function e(t){if(o(this,e),t.id&&(this.id=t.id),t.name&&(this.name=t.name),t.data&&(this.data=t.data),t.avatar_url&&(this.avatarUrl=t.avatar_url),t.participants){this.participants=[];for(var n in t.participants)this.participants.push(new g.default(t.participants[n]))}t.participants_count?this.participantsCount=t.participants_count:this.participantsCount=0,t.custom_filter&&(this.customFilter=t.custom_filter),t.unread_message_count?this.unreadMessageCount=t.unread_message_count:this.unreadMessageCount=0,t.last_message&&(this.lastMessage=new m.default(t.last_message)),t.is_distinct?this.isDistinct=t.is_distinct:this.isDistinct=!1,t.read_receipt&&(this.readReceipt=t.read_receipt),t.is_archive&&(this.isArchive=t.isArchive),t.inserted_at&&(this.insertedAt=this.inserted_at),t.created_by&&(this.createdBy=t.created_by),t.updated_at&&(this.updatedAt=t.updated_at),t.metadata&&(this.metadata=t.metadata),this.cachedParticipantsTypingStatus=[],this.lastStartTyping=0,this.lastStopTyping=0}return s(e,[{key:"join",value:function(e){var t=this,n=a.default.getInstance().transportManager.send({t:"open_channels.join",d:{id:this.id}});return this.toSuccessFunc=function(r){return window.setTimeout(function(){a.default.getInstance().off("to."+n+".success",t.toSuccessFunc),a.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(null)},this.toErrorFunc=function(r){new c.default(r);return window.setTimeout(function(){a.default.getInstance().off("to."+n+".success",t.toSuccessFunc),a.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(r)},a.default.getInstance().on("to."+n+".success",this.toSuccessFunc),a.default.getInstance().on("to."+n+".error",this.toErrorFunc),!0}},{key:"leave",value:function(e){var t=this,n=a.default.getInstance().transportManager.send({t:"open_channels.leave",d:{id:this.id}});return this.toSuccessFunc=function(r){return window.setTimeout(function(){a.default.getInstance().off("to."+n+".success",t.toSuccessFunc),a.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(null)},this.toErrorFunc=function(r){new c.default(r);return window.setTimeout(function(){a.default.getInstance().off("to."+n+".success",t.toSuccessFunc),a.default.getInstance().off("to."+n+".error",t.toErrorFunc)},0),e(r)},a.default.getInstance().on("to."+n+".success",this.toSuccessFunc),a.default.getInstance().on("to."+n+".error",this.toErrorFunc),!0}},{key:"sendMessage",value:function(e,t,n,r){return r?this._sendMessage({message:e,metadata:t,customType:n},r):n?this._sendMessage({message:e,metadata:t},n):!!t&&this._sendMessage({message:e},t)}},{key:"_sendMessage",value:function(e,t){var n=this,r={id:this.id,text:e.message,type:"text"};e.metadata&&(r.metadata=e.metadata),e.customType&&(r.custom_type=e.customType);var o=a.default.getInstance().transportManager.send({t:"open_channels.message",d:r});return this.toFunc=function(e){return window.setTimeout(function(){a.default.getInstance().off("to."+o,n.toFunc)},0),t(null,e)},a.default.getInstance().on("to."+o,this.toFunc),!0}},{key:"sendAttachment",value:function(e,t,n){var r=this;a.default.getInstance()._uploadAttachment(e,"open_channel",this.id,t,function(e,t){if(e)return n(e,null);var o=a.default.getInstance().transportManager.send({t:"open_channels.message",d:{id:r.id,type:"attachment",attachment:t}});return r.toFunc=function(e){return window.setTimeout(function(){a.default.getInstance().off("to."+o,r.toFunc)},0),n(null,e)},a.default.getInstance().on("to."+o,r.toFunc),!0})}},{key:"isTyping",value:function(){return Object.keys(this.cachedParticipantsTypingStatus).length>0}},{key:"setTypingStatus",value:function(e,t){t?this.cachedParticipantsTypingStatus[e]=(new Date).getTime():delete this.cachedParticipantsTypingStatus[e]}},{key:"checkTypingStatus",value:function(){var e=!1;for(var t in this.cachedParticipantsTypingStatus)this.cachedParticipantsTypingStatus[t]<(new Date).getTime()-1e4&&(delete this.cachedParticipantsTypingStatus[t],e=!0);return e}},{key:"startTyping",value:function(){var e=this;if(this.lastStartTyping<(new Date).getTime()-1e4){var t=a.default.getInstance().transportManager.send({t:"group_channels.start_typing",d:{id:this.id}});return this.toFunc=function(n){return window.setTimeout(function(){a.default.getInstance().off("to."+t,e.toFunc)},0),cb(null,n)},this.lastStartTyping=(new Date).getTime(),!0}}},{key:"stopTyping",value:function(){var e=this;if(this.lastStopTyping<(new Date).getTime()-1e4){var t=a.default.getInstance().transportManager.send({t:"group_channels.stop_typing",d:{id:this.id}});return this.toFunc=function(n){return window.setTimeout(function(){a.default.getInstance().off("to."+t,e.toFunc)},0),cb(null,n)},this.lastStopTyping=(new Date).getTime(),!0}}},{key:"getTypingParticipants",value:function(){var e=[];for(var t in this.cachedParticipantsTypingStatus)for(var n in this.participants)if(t===this.participants[n].id){e.push(this.participants[n]);break}return e}}],[{key:"get",value:function(e,t){return this._getFromServer(e,t)}},{key:"_getFromServer",value:function(e,t){var n=this,r=a.default.getInstance().transportManager.send({t:"open_channels.get",d:{id:e}});return this.toSuccessFunc=function(e){return window.setTimeout(function(){a.default.getInstance().off("to."+r+".success",n.toSuccessFunc),a.default.getInstance().off("to."+r+".error",n.toErrorFunc)},0),t(null,e)},this.toErrorFunc=function(e){var o=new c.default(e);return window.setTimeout(function(){a.default.getInstance().off("to."+r+".success",n.toSuccessFunc),a.default.getInstance().off("to."+r+".error",n.toErrorFunc)},0),t(o,null)},a.default.getInstance().on("to."+r+".success",this.toSuccessFunc),a.default.getInstance().on("to."+r+".error",this.toErrorFunc),!0}}]),s(e,[{key:"getId",value:function(){return this.id}},{key:"getName",value:function(){return this.name}},{key:"createPreviousMessageListQuery",value:function(){return new d.default(this)}},{key:"refresh",value:function(){}}],[{key:"createOpenChannelListQuery",value:function(){return new f.default}}]),e}();t.default=v}])});